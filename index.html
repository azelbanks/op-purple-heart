<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OP: PURPLE HEART // TERMINAL</title>
    <style>
        /* --- STYLE GENERAL & FONTS --- */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;500;700&display=swap');

        :root {
            --bg-color: #050505;
            --terminal-bg: #0d0d14;
            --text-color: #a8b2d1;
            --primary: #8a2be2; /* Purple Heart */
            --accent: #00ff41; /* Hacker Green */
            --error: #ff3333;
            --border: #2d2d3a;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000 100%);
        }

        /* --- LAYOUT --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        /* --- SIDEBAR (Profil CV) --- */
        .sidebar {
            background: var(--terminal-bg);
            border: 1px solid var(--primary);
            padding: 20px;
            height: fit-content;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.2);
        }

        .avatar {
            width: 100%;
            height: 150px;
            background: #000;
            border: 1px dashed var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 3em;
        }

        .info-block h3 {
            color: var(--primary);
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
            margin-top: 20px;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .info-block p {
            font-size: 0.8em;
            margin: 5px 0;
            color: #fff;
        }

        .progress-container {
            margin-top: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #333;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s;
            box-shadow: 0 0 10px var(--primary);
        }

        /* --- MAIN DASHBOARD --- */
        .main-content {
            background: rgba(13, 13, 20, 0.9);
            border: 1px solid var(--border);
            padding: 20px;
        }

        h1 {
            margin: 0 0 20px 0;
            color: #fff;
            text-shadow: 0 0 5px var(--primary);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }

        .day-btn {
            background: #111;
            border: 1px solid var(--border);
            color: var(--text-color);
            padding: 20px;
            font-family: 'Fira Code', monospace;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100px;
            position: relative;
        }

        .day-btn:hover:not(:disabled) {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.4);
            transform: translateY(-2px);
        }

        .day-btn.solved {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(0, 255, 65, 0.05);
        }
        
        .day-btn.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: repeating-linear-gradient(45deg, #000, #000 10px, #111 10px, #111 20px);
        }

        .day-number { font-size: 1.5em; font-weight: bold; }
        .day-status { font-size: 0.7em; margin-top: 5px; }

        /* --- MODAL (TERMINAL) --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .terminal-window {
            width: 800px;
            max-width: 90%;
            background: #1a1a1a;
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.2);
            animation: slideUp 0.3s ease-out;
        }

        .terminal-header {
            background: var(--primary);
            color: #000;
            padding: 5px 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .terminal-body {
            padding: 20px;
            color: #ddd;
        }

        .code-block {
            background: #000;
            border-left: 3px solid var(--accent);
            padding: 10px;
            margin: 15px 0;
            font-family: monospace;
            color: var(--accent);
        }

        input[type="text"] {
            width: 100%;
            background: #000;
            border: none;
            border-bottom: 2px solid #555;
            color: #fff;
            padding: 10px;
            font-family: 'Fira Code', monospace;
            font-size: 1.1em;
            outline: none;
        }

        input[type="text"]:focus {
            border-color: var(--primary);
        }

        .action-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px 20px;
            margin-top: 15px;
            cursor: pointer;
            font-family: 'Fira Code', monospace;
            text-transform: uppercase;
            font-weight: bold;
        }

        .action-btn:hover {
            background: var(--primary);
            color: #000;
        }

        .close-btn { cursor: pointer; }

        /* --- ANIMATIONS --- */
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .success-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.9);
        }
        
        .glitch-text {
            font-size: 4em;
            font-weight: bold;
            color: var(--accent);
            text-shadow: 2px 2px var(--primary);
            animation: glitch 1s infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }

        /* LEVEL 2 HEADER */
        .level-2-header {
            margin-top: 50px;
            border-top: 1px dashed var(--primary);
            padding-top: 20px;
            text-align: center;
            color: var(--primary);
        }

    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <div class="avatar">üõ°Ô∏è</div>
        <div style="text-align: center; font-weight: bold; color:#fff;">TARGET: BRYAN</div>
        <div style="text-align: center; font-size: 0.8em; color:var(--primary); font-weight:bold;">ING√âNIEUR PURPLE TEAM</div>
        
        <div class="info-block">
            <h3>Mission Status</h3>
            <p>> OP: PURPLE HEART</p>
            <p>> Clearance: LEVEL 5</p>
            <p>> Unit: 13 RDP (RESERVE)</p>
        </div>

        <div class="info-block">
            <h3>Tech Stack</h3>
            <p>‚Ä¢ Rust / Python</p>
            <p>‚Ä¢ NixOS / Arch</p>
            <p>‚Ä¢ Burp Suite</p>
            <p>‚Ä¢ BloodHound</p>
        </div>

        <div class="info-block">
            <h3>Progress</h3>
            <p id="progress-text">0 / 24 FLAGS CAPTURED</p>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="main-progress"></div></div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <h1>> ./init_sequence.sh --force</h1>
        <p style="color: #666; margin-bottom: 30px;">// SYSTEM READY. WAITING FOR INPUT.</p>

        <div class="grid" id="calendar-grid">
            </div>

        <div id="level-2-container" style="display:none;">
            <h2 class="level-2-header">‚ö†Ô∏è LEVEL 2: BLACK OPS [25-31] ‚ö†Ô∏è</h2>
            <div class="grid" id="calendar-grid-l2">
                </div>
        </div>
    </div>
</div>

<div class="modal" id="challenge-modal">
    <div class="terminal-window">
        <div class="terminal-header">
            <span id="modal-title">TERMINAL</span>
            <span class="close-btn" onclick="closeModal()">[X]</span>
        </div>
        <div class="terminal-body">
            <div style="color:var(--primary); font-size: 0.8em; margin-bottom: 10px;">CATEGORY: <span id="modal-cat"></span></div>
            <p id="modal-desc"></p>
            
            <div id="input-area">
                <input type="text" id="flag-input" placeholder="ENTER_FLAG_HERE..." autocomplete="off">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <button class="action-btn" onclick="checkFlag()">> EXECUTE</button>
                    <div style="font-size:0.8em; cursor:pointer; color:#555;" onclick="toggleHint()">[ SHOW HINT ]</div>
                </div>
                <div id="hint-text" style="display:none; color: #555; margin-top:10px; font-style:italic;"></div>
                <p id="error-msg" style="color:var(--error); margin-top:10px; display:none;">> ACCESS DENIED. BAD FLAG.</p>
            </div>

            <div id="success-area" style="display:none;">
                <div class="code-block" id="reward-content" style="color: var(--accent);"></div>
                <div id="media-container"></div>
            </div>
        </div>
    </div>
</div>

<div class="success-overlay" id="success-overlay">
    <div class="glitch-text">ACCESS GRANTED</div>
    <div style="color: #fff; margin-top: 20px;">UPDATING PRIVILEGES...</div>
</div>

<script>
    // --- DONNEES DES CHALLENGES ---
    const challenges = {
        1: { cat: "DEFENSE_EVASION", title: "SURICATA_RULE", desc: "J'ai retrouv√© cette r√®gle IDS qui a trigger lors de notre premi√®re rencontre.<br>Quel est le contenu exact du payload d√©tect√© ?<br><span class='code-block'>alert tcp any any -> any 80 (msg:\"INITIAL_ACCESS\"; content:\"|43 48 45 4F 50 53|\"; sid:1000001; rev:1;)</span>", hint: "Hex to ASCII.", target: "CHEOPS", reward: "‚ù§Ô∏è **Alert Confirmed.** Ce jour-l√†, aucune r√®gle de pare-feu n'a pu bloquer ton entr√©e dans ma vie." },
        2: { cat: "THREAT_HUNTING", title: "ELASTIC_KQL", desc: "Kickoff Marbella. Exploitation vuln√©rabilit√© publique.<br>Quel est l'ID MITRE ATT&CK pour 'Exploit Public-Facing Application' ?", hint: "Txxxx", target: "T1190", reward: "Faille critique exploit√©e : Mon c≈ìur est maintenant expos√© publiquement √† toi." },
        3: { cat: "REVERSE_ENGINEERING", title: "GHIDRA_DISASM", desc: "üìç TARGET: GROUND ZERO (Trapiche).<br>Fonction get_location().<br>MOV RAX, 0x5061647265205061<br>MOV RBX, 0x636F204F73746F73<br>Concat√®ne RAX+RBX et convertis en ASCII.", hint: "Hex to String.", target: "PADRE PACO OSTOS", reward: "üî• **0xPADRE_PACO_OSTOS**. L'adresse m√©moire o√π mon stack a overflow." },
        4: {
        "cat": "SIGNAL_ANALYSIS",
        "title": "BEACON_PERIODICITY",
        "desc": "26 Septembre. Tu as √©crit : <i>'J‚Äôouvre en boucle mon app... faire une courbe de tendance'</i>.<br>En Threat Hunting, pour d√©tecter math√©matiquement cette addiction (un Beacon r√©gulier) cach√©e dans le bruit du r√©seau, on passe du domaine temporel au domaine fr√©quentiel.<br>Quelle <b>Transformation</b> math√©matique est utilis√©e (ex: dans l'outil RITA) pour r√©v√©ler cette p√©riodicit√© ?",
        "hint": "Transformation de F... (FFT).",
        "type": "exact_match",
        "target": "FOURIER", // Ou FAST FOURIER TRANSFORM
        "reward_type": "text",
        "reward": "üìà **SIGNAL D√âTECT√â.**<br>L'analyse de Fourier est formelle : ton c≈ìur √©met un signal p√©riodique fort vers moi.<br>Comme tu l'as dit : <i>'Y a plus de doute sur la notion d‚Äôaccro.'</i>"
    },
        5: {
        "cat": "PHISHING_PAYLOAD", 
        "title": "VBA_STOMPING", 
        "desc": "30 Septembre. Vecteur d'attaque : Spearphishing.<br>J'ai utilis√© la technique du **VBA Stomping** (EvilClippy) pour cacher mes intentions.<br>Si je supprime le code source VBA mais que la version d'Office est compatible, quel code compil√© (Bytecode) sera ex√©cut√© √† la place ?",
        "hint": "C'est le nom du code performant stock√© dans le stream OLE.",
        "type": "exact_match",
        "target": "P-CODE", 
        "reward_type": "text",
        "reward": "üß† **EXECUTION P-CODE CONFIRM√âE.**<br>Tu as su lire mon **P-Code** directement. Tu n'as pas besoin de mes mots (Source) pour comprendre mes intentions.<br><br>üéµ **PAYLOAD AUDIO EXTRAIT :**<br><a href='https://open.spotify.com/playlist/1HlLqxJchhup00no1qbPZQ?si=LWBxjB3TSh-81K5Q8IK5Bg' target='_blank' style='color:#00ff41; text-decoration:underline; font-weight:bold;'>[ > LANCER LA PLAYLIST ]</a>"
    },
    6: {
        "cat": "CUSTOM_CRYPTO_ALGO",
        "title": "SYNCHRONIZED_MEMORY",
        "desc": "Analyse d'un dump m√©moire. J'ai isol√© la s√©quence exacte o√π nos esprits se sont synchronis√©s.<br>Ce n'est pas un chiffrement statique, c'est un <b>Rolling Adder</b> (Stateful).<br><br><b>LOGIQUE :</b><br>1. <code>Init Key = 21</code>.<br>2. <code>Enc[i] = (Char[i] + Key) modulo 256</code><br>3. <code>Key = Enc[i]</code> (L'√©tat change √† chaque interaction).<br><br><b>PAYLOAD (Decimal) :</b> <code>100 183 4 83 166 235</code><br><br>Sors ton script. Prouve-moi que tu peux suivre la cadence.",
        "hint": "L'op√©ration inverse de l'addition modulaire est la soustraction modulaire. Python: (Enc - Key) % 256.",
        "type": "exact_match",
        "target": "OSMOSE", 
        "reward_type": "text",
        "reward": "üß© **OSMOSE CONFIRM√âE.**<br>Tu as cass√© le code.<br><i>'Comme cet algorithme, chaque instant pass√© avec toi modifie le suivant. C'est un chiffrement unique que nous seuls pouvons comprendre.'</i>"
    },  
        7: {
        "cat": "AD_INTERNALS",
        "title": "SID_BINARY_PARSING",
        "desc": "Escalade de privil√®ges r√©ussie : Domain Admin.<br>Pour persister, j'ai forg√© un <b>SID</b> (Security Identifier) unique dans l'Active Directory de notre relation.<br>La date de cet exploit est cach√©e dans la 3√®me Sous-Autorit√© (SubAuthority).<br><br><b>RAW HEX :</b> <code>01 05 00 00 00 00 00 05 15 00 00 00 6E 52 B7 39 40 4E 84 41 C9 F4 04 01 F4 01 00 00</code><br><br>Convertis ce bloc sp√©cifique pour retrouver la date (Format JJMMAAAA).",
        "hint": "Structure SID : Revision (1b) - Count (1b) - Authority (6b) - SubAuthorities (4b each). Cherche l'avant-dernier bloc de 4 octets avant le RID 500. Attention au Little Endian.",
        "type": "exact_match",
        "target": "17102025", 
        "reward_type": "text",
        "reward": "üëë **DOMAIN ADMIN CONFIRM√â.**<br>Le <b>17.10.2025</b>, tu as pris le contr√¥le total (GenericAll) sur l'objet <i>Coeur_Az</i>.<br>Plus de restrictions d'acc√®s."
    },
        8: {
        "cat": "MALWARE_ANALYSIS",
        "title": "STACK_STRING_DEOBFUSCATION",
        "desc": "3 Novembre. Analyse statique.<br>Pour √©chapper √† la d√©tection (AV Evasion), je n'ai pas √©crit mon d√©sir en clair. Je l'ai construit dynamiquement en m√©moire (Stack String).<br>Voici le d√©sassemblage de la fonction d'initialisation :<br><br><code>C6 45 F0 42</code><br><code>C6 45 F1 6F</code><br><code>C6 45 F2 64</code><br><code>C6 45 F3 79</code><br><br>Reconstitue l'objet ASCII form√© par ces instructions assembleur.",
        "hint": "Architecture x86. Opcode C6 45 ?? XX = MOV BYTE PTR [EBP-??], XX. Regarde les valeurs imm√©diates (XX) √† la fin de chaque ligne et convertis-les.",
        "type": "exact_match",
        "target": "BODY",
        "reward_type": "text",
        "reward": "ü¶† **PAYLOAD RECONSTRUIT.**<br>Tu as su lire mon code source profond.<br>Tu as scann√© et reconstruit mon **BODY**, instruction par instruction."
    },
     9: { cat: "PASSWORD_CRACKING", title: "HASHCAT_MODE", desc: "4 Novembre. Hash NTLMv2.<br>Quel Mode (-m) utiliser dans Hashcat ?", hint: "Code 4 chiffres.", target: "5600", reward: "Tu as bruteforc√© mes ins√©curit√©s." },
        10: { cat: "C2_INFRASTRUCTURE", title: "COBALT_STRIKE", desc: "Profil malleable C2 par d√©faut qui imite jQuery ?", hint: "jquery-...", target: "JQUERY-C2.PROFILE", reward: "Mon C2 c'est toi. J'attends tes instructions." },
        11: { cat: "DATA_ENCODING", title: "CYBERCHEF", desc: "8 Novembre. 'Sanctuaire'.<br>Recipe: To Base64 -> To Hex -> To Base64.<br>4 premiers caract√®res ?", hint: "CyberChef.", target: "NTM2", reward: "‚ù§Ô∏è SANCTUAIRE. Notre VPN chiffr√©." },
        12: { cat: "PYTHON_SCRIPTING", title: "ASSERTION_ERROR", desc: "14 Novembre.<br>assert Actions > Mots<br>Si faux, quelle exception ?", hint: "Nom de l'erreur.", target: "ASSERTIONERROR", reward: "Mes actes ne l√®veront jamais d'exception." },
        13: { cat: "CREDENTIAL_DUMPING", title: "LSASS_DUMP", desc: "Outil Sysinternals pour dumper un processus ?", hint: "Proc...", target: "PROCDUMP", reward: "Miaou. üêà (Flag extrait de lsass.dmp)" },
        14: { cat: "RUST_PROGRAMMING", title: "MEMORY_SAFETY", desc: "Rust : M√©canisme contre les Race Conditions sur les donn√©es ?", hint: "M...", target: "MUTEX", reward: "Write Lock exclusif sur ton c≈ìur." },
        15: { cat: "GEOLOC", title: "WIFI_BSSID", desc: "MALAGA. Broadcast Address ?", hint: "FF...", target: "FF:FF:FF:FF:FF:FF", reward: "VIDEO: https://www.youtube.com/watch?v=dQw4w9WgXcQ" }, // EXEMPLE VIDEO
        16: { cat: "PRIVESC", title: "GTFOBINS", desc: "Sudo vim. Commande pour shell ?", hint: ":!...", target: ":!/BIN/SH", reward: "Root access granted (1995)." },
        17: { cat: "CRYPTOGRAPHY", title: "ROT13", desc: "Payload : GECB PUBH", hint: "ROT13", target: "TROP CHOU", reward: "Tu aimes quand je d√©fends mon p√©rim√®tre." },
        18: { cat: "WINDOWS_INTERNALS", title: "SID_LOOKUP", desc: "RID par d√©faut Administrateur ?", hint: "500 ?", target: "500", reward: "User: Bryan | SID: ...-500" },
        19: { cat: "LOOT", title: "DATA_EXFIL", desc: "Cadeau : Musique.", type: "loot", reward: "üéµ Playlist : [Ins√©rer Lien]" },
        20: { cat: "LOOT", title: "SOCIAL_ENG", desc: "Cadeau : Meme.", type: "loot", reward: "IMAGE: https://media.giphy.com/media/super/giphy.gif" },
        21: { cat: "LOOT", title: "KEYLOGGER", desc: "Log du jour.", type: "loot", reward: "Tu me manques." },
        22: { cat: "LOOT", title: "SNAPSHOT", desc: "Souvenir VM.", type: "loot", reward: "üì∏" },
        23: { cat: "LOOT", title: "PATCH_TUESDAY", desc: "Mise √† jour.", type: "loot", reward: "J-1." },
        24: { cat: "APT_CAMPAIGN", title: "FINAL_PAYLOAD", desc: "No√´l. Nom de code (Couleur + Team).", hint: "P... T...", target: "PURPLE TEAM", reward: "üéÅ JOYEUX NO√ãL. APT 'Purple Team' install√©e." },
        25: { cat: "THREAT_INTEL", title: "MISP_EVENT", desc: "Threat Level le plus bas dans MISP ?", hint: "Low...", target: "LOW", reward: "Aucune menace d√©tect√©e." },
        26: { cat: "WEB_FUZZING", title: "FFUF_FUZZ", desc: "ffuf. Code HTTP succ√®s ?", hint: "200...", target: "200", reward: "Status 200 OK." },
        27: { cat: "AD_ATTACK", title: "KERBEROASTING", desc: "Impacket outil TGS ?", hint: "GetU...", target: "GETUSERSPNS", reward: "Ticket Kerberos obtenu." },
        28: { cat: "C2_FRAMEWORK", title: "SLIVER_C2", desc: "Sliver. Nom binaire par d√©faut ?", hint: "Sliver / Implant", target: "SLIVER", reward: "Implant d√©ploy√©." },
        29: { cat: "BINARY_EXPLOITATION", title: "BUFFER_OVERFLOW", desc: "Assembly : Jump to ESP ?", hint: "JMP...", target: "JMP ESP", reward: "Shellcode ex√©cut√© : Amour infini." },
        30: { cat: "LATERAL_MOVEMENT", title: "WMI_EXEC", desc: "Port TCP WMI (DCOM) ?", hint: "135...", target: "135", reward: "Connexion √©tablie." },
        31: { cat: "CODE_REVIEW", title: "GIT_COMMIT", desc: "Modifier dernier commit ?", hint: "amend", target: "AMEND", reward: "üéÜ BONNE ANN√âE 2026." }
    };

    // --- ETAT DU JEU ---
    // Mode Production : Utilise la date r√©elle de l'appareil
    const debugDate = new Date(); 
    
    let solvedDays = JSON.parse(localStorage.getItem('solvedDays_bryan')) || [];
    let currentDay = null;

    function init() {
        const grid1 = document.getElementById('calendar-grid');
        const grid2 = document.getElementById('calendar-grid-l2');
        
        // Grid 1-24
        for (let i = 1; i <= 24; i++) {
            createDayBtn(i, grid1);
        }

        // Si le jour 24 est r√©solu, on affiche le niveau 2
        if (solvedDays.includes(24)) {
            document.getElementById('level-2-container').style.display = 'block';
            for (let i = 25; i <= 31; i++) {
                createDayBtn(i, grid2);
            }
        }
        updateProgress();
    }

    function createDayBtn(day, container) {
        const btn = document.createElement('div');
        const isSolved = solvedDays.includes(day);
        const isLocked = (debugDate.getMonth() !== 11) || (debugDate.getDate() < day); // Mois 11 = D√©cembre en JS

        btn.className = `day-btn ${isSolved ? 'solved' : ''} ${isLocked && !isSolved ? 'locked' : ''}`;
        
        // Contenu visuel
        let icon = isSolved ? '‚úÖ' : (isLocked ? 'üîí' : '‚ò†Ô∏è');
        if (day >= 25) icon = isSolved ? 'üíú' : (isLocked ? 'üîí' : 'üíÄ');
        
        btn.innerHTML = `<div class="day-number">${day < 10 ? '0'+day : day}</div><div class="day-status">${icon}</div>`;
        
        if (!isLocked || isSolved) {
            btn.onclick = () => openChallenge(day);
        }
        
        container.appendChild(btn);
    }

    function openChallenge(day) {
        currentDay = day;
        const data = challenges[day];
        const modal = document.getElementById('challenge-modal');
        const isSolved = solvedDays.includes(day);

        // Reset UI
        document.getElementById('modal-title').innerText = `// DAY_${day} :: EXECUTING`;
        document.getElementById('modal-cat').innerText = data.cat;
        document.getElementById('modal-desc').innerHTML = data.desc;
        document.getElementById('flag-input').value = "";
        document.getElementById('error-msg').style.display = 'none';
        document.getElementById('hint-text').style.display = 'none';
        
        const inputArea = document.getElementById('input-area');
        const successArea = document.getElementById('success-area');

        modal.style.display = 'flex';

        // Logique Loot ou D√©j√† r√©solu
        if (isSolved || data.type === 'loot') {
            if (!isSolved) {
                // Auto solve loot
                solvedDays.push(day);
                localStorage.setItem('solvedDays_bryan', JSON.stringify(solvedDays));
                updateProgress();
            }
            showReward(data);
        } else {
            inputArea.style.display = 'block';
            successArea.style.display = 'none';
        }
    }

    function checkFlag() {
        const input = document.getElementById('flag-input').value.trim().toUpperCase();
        const data = challenges[currentDay];
        
        if (input === data.target.toUpperCase()) {
            // SUCCESS
            triggerSuccessAnimation();
            solvedDays.push(currentDay);
            localStorage.setItem('solvedDays_bryan', JSON.stringify(solvedDays));
            
            setTimeout(() => {
                showReward(data);
                updateProgress();
                // Si c'est le jour 24, recharger pour afficher le niveau 2
                if (currentDay === 24) location.reload();
            }, 2000);
        } else {
            // FAIL
            document.getElementById('error-msg').style.display = 'block';
            shakeModal();
        }
    }

    function showReward(data) {
        document.getElementById('input-area').style.display = 'none';
        const successArea = document.getElementById('success-area');
        const rewardContent = document.getElementById('reward-content');
        const mediaContainer = document.getElementById('media-container');
        
        successArea.style.display = 'block';
        
        let content = data.reward;
        mediaContainer.innerHTML = ""; 

        if (content.startsWith("IMAGE:")) {
            const url = content.replace("IMAGE:", "").trim();
            mediaContainer.innerHTML = `<img src="${url}" style="max-width:100%; border:1px solid var(--primary); margin-top:10px;">`;
            rewardContent.innerText = "> DECRYPTED IMAGE FILE.";
        } else if (content.startsWith("VIDEO:")) {
            const url = content.replace("VIDEO:", "").trim();
            rewardContent.innerText = `> VIDEO LINK EXTRACTED: ${url}`;
        } else {
            rewardContent.innerHTML = content;
        }
    }

    function triggerSuccessAnimation() {
        const overlay = document.getElementById('success-overlay');
        overlay.style.display = 'flex';
        setTimeout(() => {
            overlay.style.display = 'none';
        }, 2000);
    }

    function shakeModal() {
        const win = document.querySelector('.terminal-window');
        win.style.transform = 'translateX(10px)';
        setTimeout(() => win.style.transform = 'translateX(-10px)', 50);
        setTimeout(() => win.style.transform = 'translateX(10px)', 100);
        setTimeout(() => win.style.transform = 'translateX(0)', 150);
    }

    function toggleHint() {
        const hint = document.getElementById('hint-text');
        hint.innerText = "> HINT: " + challenges[currentDay].hint;
        hint.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('challenge-modal').style.display = 'none';
        location.reload(); 
    }

    function updateProgress() {
        const level2Unlocked = solvedDays.includes(24);
        const total = level2Unlocked ? 31 : 24;
        const percent = (solvedDays.length / total) * 100;
        document.getElementById('main-progress').style.width = percent + "%";
        document.getElementById('progress-text').innerText = `${solvedDays.length} / ${total} FLAGS CAPTURED`;
    }

    document.getElementById('flag-input').addEventListener("keypress", function(event) {
        if (event.key === "Enter") checkFlag();
    });

    init();

</script>
</body>
</html>
